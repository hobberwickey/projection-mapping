<template id="sc-content">
  <div class="content uk-flex">
    <div class="uk-width-2-10 objects">
      <ul>
        <li class="collapsable">
          <h2>Scripts</h2>
          <ul>
            <li>Script 1</li>
            <li>Script 2</li>
            <li>Script 3</li>
          </ul>
        </li>
        <li class="collapsable">
          <h2>Triangles</h2>
          <ul>
            <li>Triangle 1</li>
            <li>Triangle 2</li>
            <li>Triangle 3</li>
          </ul>
        </li>
        <li class="collapsable">
          <h2>Quads</h2>
          <ul>
            <li>Quad 1</li>
            <li>Quad 2</li>
            <li>Quad 3</li>
          </ul>
        </li>
        <li class="collapsable">
          <h2>Circles</h2>
          <ul>
            <li>Circle 1</li>
            <li>Circle 2</li>
            <li>Circle 3</li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="uk-width-8-10 controller">
      <div class="slots uk-width-1-1 uk-flex">
        <div class="uk-width-1-2">
          <label>Script Slots</label>
          <slot-list
            :select="selectScript"
            :update="updateScript"
            :selected="selectedScript"
            :items="[]"
            class="effects uk-grid-collapse"
            uk-grid
          ></slot-list>
        </div>
        <div class="uk-width-1-2">
          <label>Effect Slots</label>
          <slot-list
            :select="selectEffect"
            :update="updateEffect"
            :selected="selectedEffect"
            :items="app?.effects"
            class="effects uk-grid-collapse"
            uk-grid
          ></slot-list>
        </div>
      </div>
      <div class="controls uk-width-1-1 uk-flex">
        <div class="videos uk-width-6-10">
          <video-slots :app="app" :selected="selectedVideo"></video-slots>
        </div>
        <div class="sliders uk-width-4-10">
          <div>
            <vertical-range></vertical-range>
            <vertical-range></vertical-range>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
  class SCContent extends Component {
    constructor() {
      super();
    }

    static get observedProperties() {
      return [
        "app",
        "state",
        "selectedVideo",
        "selectedEffect",
        "selectedScript",
      ];
    }

    connected() {
      this.listen("state", "state-changed", (state) => {
        // Todo: There's probably a more effecticent way of transfers these bindings
        this.selectedVideo = state.selected.video;
        this.selectedEffect = state.selected.effect;
        this.selectedScript = state.selected.script;
      });

      this.listen("app", "app-loaded", (app) => {
        console.log("App Loaded:", app.effects)
      })

      this.listen("selectedEffect", "select-effect", (selected) => {
        let slots = this.querySelectorAll("slot-items.effects").forEach(
          (slot, idx) => {
            slot.classList.toggle("selected", selected === idx);
          },
        );
      });

      this.listen("selectedScript", "select-script", (selected) => {
        let slots = this.querySelectorAll("slot-items.scripts").forEach(
          (slot, idx) => {
            slot.classList.toggle("selected", selected === idx);
          },
        );
      });
    }

    selectEffect(idx) {
      this.app.updateSelected("effect", idx);
    }

    updateEffect(idx, effect) {
      console.log(idx, effect)
      this.app.setEffect(idx, effect);
    }

    selectScript(idx) {
      console.log("Script Selected", idx);
      this.app.updateSelected("script", idx);
    }

    updateScript(idx, script) {
      console.log("Script Updated:", idx, effect);
    }
  }
</script>
