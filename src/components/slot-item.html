<template>
  <div class="select">
    <div class="select-display">{{getLabel(selected)}}</div>
    <div class="select-list">
      <ul class="uk-list">
        <li @click="updateSelection($event)">Empty</li>
        <template :for="options">
          <li @click="updateSelection($value.id)">{{$value.label}}</li>
        </template>
      </ul>
    </div>
    <div class="select-handle" @click="toggleActive($event)">
      <span uk-icon="icon: triangle-down"></span>
    </div>
  </div>
</template>

<script>
  class SlotList extends Component {
    constructor() {
      super();
    }

    static get observedProperties() {
      return ["idx", "selected", "options", "select", "update"];
    }

    connected() {
      this.listen("selected", (selected) => {
        this.label = this.options[selected]?.label || "Empty";
      });
    }

    toggleActive(e) {
      e.preventDefault();
      e.stopPropagation();

      this.querySelector(".select").classList.add("active");

      window.addEventListener("click", () => {
        this.querySelector(".select").classList.remove("active");
      });
    }

    getLabel(effect) {
      if (!effect) {
        return "Empty";
      }

      let effects = document.querySelector("sensory-controls").app?.effects;

      return effects.find((e) => e.id === effect)?.label || "Empty";
    }

    setSelected(idx) {
      this.select(idx);
    }

    updateSelection(id) {
      this.update(this.idx, id || null);
    }
  }
</script>
