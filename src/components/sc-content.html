<template id="sc-content">
  <div class="content uk-flex">
    <div class="uk-width-2-10 objects">
      <object-lists :app="app" :state="state"></object-lists>
    </div>
    <div class="uk-width-8-10 controller">
      <!-- <led-bar id="script_lights"></led-bar> -->
      <!-- <horizontal-led-bar id="h_script_lights"></horizontal-led-bar> -->

      <div class="slots uk-width-1-1 uk-flex">
        <div class="uk-width-1-2">
          <label>Script Slots</label>
          <div class="slot-list">
            <slot-item
              :idx="0"
              :app="app"
              :options="effects || []"
              :class="classes(0)"
              @click="select('slot', 0)"
            ></slot-item>
            <slot-item
              :idx="1"
              :app="app"
              :options="effects || []"
              :class="classes(1)"
              @click="select('slot', 1)"
            ></slot-item>
            <slot-item
              :idx="5"
              :app="app"
              :options="effects || []"
              :class="classes(5)"
              @click="select('slot', 5)"
            ></slot-item>
            <slot-item
              :idx="2"
              :app="app"
              :options="effects || []"
              :class="classes(2)"
              @click="select('slot', 2)"
            ></slot-item>
            <slot-item
              :idx="4"
              :app="app"
              :options="effects || []"
              :class="classes(4)"
              @click="select('slot', 4)"
            ></slot-item>
            <slot-item
              :idx="3"
              :app="app"
              :options="effects || []"
              :class="classes(3)"
              @click="select('slot', 3)"
            ></slot-item>
          </div>
        </div>
        <div class="uk-width-1-2">
          <label>Effect Slots</label>
          <div class="slot-list">
            <slot-item
              :idx="6"
              :app="app"
              :options="effects || []"
              :class="classes(6)"
              @click="select('slot', 6)"
            ></slot-item>
            <slot-item
              :idx="7"
              :app="app"
              :options="effects || []"
              :class="classes(7)"
              @click="select('slot', 7)"
            ></slot-item>
            <slot-item
              :idx="11"
              :app="app"
              :options="effects || []"
              :class="classes(11)"
              @click="select('slot', 11)"
            ></slot-item>
            <slot-item
              :idx="8"
              :app="app"
              :options="effects || []"
              :class="classes(8)"
              @click="select('slot', 8)"
            ></slot-item>
            <slot-item
              :idx="10"
              :app="app"
              :options="effects || []"
              :class="classes(10)"
              @click="select('slot', 10)"
            ></slot-item>
            <slot-item
              :idx="9"
              :app="app"
              :options="effects || []"
              :class="classes(9)"
              @click="select('slot', 9)"
            ></slot-item>
          </div>
        </div>
      </div>

      <div class="controls uk-width-1-1 uk-flex">
        <div class="videos uk-width-6-10">
          <div class="uk-child-width-1-3@s uk-grid-collapse" uk-grid>
            <video-slot
              :idx="0"
              :app="app"
              :opacity="getOpacity(0)"
              :class='selectedVideo === 0 ? "selected" : ""'
              @click="select('video', 0)"
            ></video-slot>
            <video-slot
              :idx="1"
              :app="app"
              :opacity="getOpacity(1)"
              :class='selectedVideo === 1 ? "selected" : ""'
              @click="select('video', 1)"
            ></video-slot>
            <video-slot
              :idx="2"
              :app="app"
              :opacity="getOpacity(2)"
              :class='selectedVideo === 2 ? "selected" : ""'
              @click="select('video', 2)"
            ></video-slot>
            <video-slot
              :idx="3"
              :app="app"
              :opacity="getOpacity(3)"
              :class='selectedVideo === 3 ? "selected" : ""'
              @click="select('video', 3)"
            ></video-slot>
            <video-slot
              :idx="4"
              :app="app"
              :opacity="getOpacity(4)"
              :class='selectedVideo === 4 ? "selected" : ""'
              @click="select('video', 4)"
            ></video-slot>
            <video-slot
              :idx="5"
              :app="app"
              :opacity="getOpacity(5)"
              :class='selectedVideo === 5 ? "selected" : ""'
              @click="select('video', 5)"
            ></video-slot>
          </div>
          <!-- <video-slots :app="app" :selected="selectedVideo"></video-slots> -->
        </div>
        <div class="sliders uk-width-4-10">
          <div>
            <vertical-range
              :value="Array.isArray(values) ? values[0] : 0"
              :update="setEffectValue.bind(null, 0)"
            ></vertical-range>
            <vertical-range
              :value="Array.isArray(values) ? values[1] : 0"
              :update="setEffectValue.bind(null, 1)"
            ></vertical-range>
          </div>
        </div>
      </div>

      <!-- <led-bar id="effect_a_lights"></led-bar>
      <led-bar id="effect_b_lights"></led-bar> -->
    </div>
  </div>
</template>

<script>
  class SCContent extends Component {
    constructor() {
      super();
    }

    static get observedProperties() {
      return [
        "app",
        "state",
        "selectedVideo",
        "selectedEffect",
        "selectedScript",
        "order",
        "effects",
        "scripts",
        "values",
      ];
    }

    connected() {
      this.order = [0, 1, 5, 2, 4, 3];
      this.values = [0, 0];

      this.listen("app", (app) => {
        this.state = app.state;
        this.effects = app.effects;
        this.scripts = app.scripts;

        app.listen("scripts", (scripts) => {
          this.scripts = scripts;
        });

        app.listen("effects", (effects) => {
          this.effects = effects;
        });

        app.listen("state", (state) => {
          this.state = state;
          this.selectedVideo = state.selected.video;
          this.selectedEffect = state.selected.effect;
          this.selectedScript = state.selected.script;
          this.values = [...this.app.getSelectedValues()];
        });
      });
    }

    classes(idx) {
      let { slots, selected } = this.state || {};
      let classList = [];

      if (!slots || !selected) {
        return "";
      }

      let slot = slots[idx];

      if (selected.slot === idx) {
        classList.push("selected");
      }

      if (slot.disabled) {
        classList.push("disabled");
      }

      return classList.join(" ");
    }

    select(type, idx) {
      this.app.updateSelected(type, idx);
    }

    updateEffect(idx, effect) {
      this.app.setEffect(idx, effect);
    }

    updateScript(idx, script_id) {
      this.app.setScript(idx, script_id);
    }

    setEffectValue(idx, e) {
      this.app.updateValue(idx, e.target.value);
    }

    getOpacity(idx) {
      return (this.state?.videos || [])[idx]?.opacity || 0;
    }
  }
</script>
