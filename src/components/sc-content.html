<template id="sc-content">
  <div class="content uk-flex">
    <div class="uk-width-2-10 objects">
      <object-lists :app="app" :state="state"></object-lists>
    </div>
    <div class="uk-width-8-10 controller">
      <div class="slots uk-width-1-1 uk-flex">
        <div class="uk-width-1-2">
          <label>Script Slots</label>
          <slot-list
            :select="selectScript"
            :update="updateScript"
            :selected="selectedScript"
            :options="app?.scripts || []"
            :items="state?.scripts || []"
            class="effects uk-grid-collapse"
            uk-grid
          ></slot-list>
        </div>
        <div class="uk-width-1-2">
          <label>Effect Slots</label>
          <slot-list
            :select="selectEffect"
            :update="updateEffect"
            :selected="selectedEffect"
            :options="app?.effects || []"
            :items="state?.effects || []"
            class="effects uk-grid-collapse"
            uk-grid
          ></slot-list>
        </div>
      </div>
      <div class="controls uk-width-1-1 uk-flex">
        <div class="videos uk-width-6-10">
          <video-slots :app="app" :selected="selectedVideo"></video-slots>
        </div>
        <div class="sliders uk-width-4-10">
          <div>
            <vertical-range
              :update="setEffectValue.bind(null, 0)"
            ></vertical-range>
            <vertical-range
              :update="setEffectValue.bind(null, 1)"
            ></vertical-range>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
  class SCContent extends Component {
    constructor() {
      super();
    }

    static get observedProperties() {
      return [
        "app",
        "state",
        "selectedVideo",
        "selectedEffect",
        "selectedScript",
      ];
    }

    connected() {
      this.listen("app", (app) => {
        this.state = app.state;

        app.listen("state", (state) => {
          this.state = state;
          this.selectedVideo = state.selected.video;
          this.selectedEffect = state.selected.effect;
          this.selectedScript = state.selected.script;
        });

        // this.listen("selectedEffect", (selected) => {
        //   let slots = this.querySelectorAll("slot-items.effects").forEach(
        //     (slot, idx) => {
        //       slot.classList.toggle("selected", selected === idx);
        //     },
        //   );
        // });

        // this.listen("selectedScript", (selected) => {
        //   let slots = this.querySelectorAll("slot-items.scripts").forEach(
        //     (slot, idx) => {
        //       slot.classList.toggle("selected", selected === idx);
        //     },
        //   );
        // });
      });
    }

    selectEffect(idx) {
      this.app.updateSelected("effect", idx);
    }

    updateEffect(idx, effect) {
      this.app.setEffect(idx, effect);
    }

    selectScript(idx) {
      this.app.updateSelected("script", idx);
    }

    updateScript(idx, script) {
      console.log("Script Updated:", idx, effect);
    }

    setEffectValue(effect, e) {
      this.app.updateEffect(effect, e.target.value);
    }
  }
</script>
